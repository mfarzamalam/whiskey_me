{% extends 'new_template/base.html' %}
{% load static %}

{% block newMain %}

<div class="container-fluid">
    <div class=" bg-orange text-black fw-bold py-1 my-3">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#product-navigation" aria-controls="mainnavigation" aria-expanded="false" aria-label="Toggle navigation">
                    <h3 class="text-white fw-bold"><b>More Whiskeys</b>   <span>  <i class="fas fa-wine-bottle"></i></span></h3>
                </button>
                <div class="collapse navbar-collapse" id="product-navigation">
                    <ul class="navbar-nav d-flex justify-content-between fw-bold ">
                        <li class="nav-item">
                            <a class="nav-link text-black fw-bold" href="{% url 'pages:shop' %}" class="text-white"><ins>ALL WHISKIES</ins></a>
                        </li>
                        
                    </ul>
                </div>
        </nav>
    </div>
</div>

<div id="product-page" class="container-fluid py-3 my-3">
    <div class="row">
        <div class="col-12 col-md-6 p-0 ps-md-4" >
            <img src="{{product.picture.url}}" class="img-fluid border-radius">
        </div>
        <div class="col-12 col-md-6  ">
            <div>
                <div class="ps-1">
                    <h1 class="fw-bold text-black my-1">
                        {{product.product_name}}
                    </h1>
                    <h4 class="fw-bold text-black my-1">
                        {{product.age}} years
                    </h4>
                </div>
                <div class="bg-orange py-2 ps-md-0 d-flex justify-content-around fw-bold text-black my-3">
                    <h4 class="fw-bold my-auto">
                        ${{product.price}} GBP
                    </h4>
                    <span>
                        <div>
                            <div>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i> <br />
                                <p>6 reviews</p>
                            </div>
                        </div>
                    </span>
                </div>
                <div class="container-fluid">
                    <div class="row p-0">
                        <div class="col-12 col-md-5 text-black fw-bold p-0">
                            <ul class="navbar-nav">
                                <li class="nav-item dropdown d-flex justify-content-center">
                                    <a class="nav-link dropdown-toggle   py-2 text-black" href="#" id="packing" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Packaging
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="#packing">
                                        <li><a class="dropdown-item" href="#">70CL</a></li>
                                        <li><a class="dropdown-item" href="#">60CL Pouch</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="col-lg-6 col-md-3 p-0">
                            <div class="quantity-button">
                                <div class="qty-input">
                                    <button onclick="decrement()" class="qty-count qty-count--minus">-</button>
                                    <input class="product-qty" id="quantity" type="text" value="1">

                                    <button onclick="increment()" class="qty-count qty-count--add">+</button>
                                </div>
                            </div>
                        </div>


                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6" >
                            <div class="col-lg-6 col-xs-6 mt-3">
                                <form action="{% url 'pages:single_address' %}" method="GET">
                                    {% csrf_token %}
                                    <button class="btn-4 fw-bold">Buy Now</button>
                                    <input type="hidden" name="product_id" value="{{product.pk}}">
                                    <input type="hidden" name="buy-now" id="buy-now" value="1">
                                </form>
                            </div>
                        </div>

                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6" >
                            <div class="col-lg-6 col-xs-6 mt-3">
                                <form action="{% url 'pages:monthly_address' %}" method="GET">
                                    {% csrf_token %}
                                    <button class="btn-4 fw-bold">Subscribe</button>
                                    <input type="hidden" name="product_id" value="{{product.pk}}">
                                    <input type="hidden" name="monthly" id="monthly" value="1">
                                    
                                </form>
                            </div>
                        </div> 
                        
                    </div>


                    <script>

                        function increment(){
                            quantity = document.getElementById('quantity').value;
                            quantity++;
                            document.getElementById('buy-now').value = quantity;
                            document.getElementById('quantity').value = quantity;
                            document.getElementById('monthly').value = quantity;
                            $('#quantity').attr('value',quantity);

                        };

                        function decrement(){
                            quantity = document.getElementById('quantity').value;
                            if (quantity > 1) {
                                quantity--;
                            }
                            document.getElementById('buy-now').value = quantity;
                            document.getElementById('quantity').value = quantity;
                            document.getElementById('monthly').value = quantity;
                            $('#quantity').attr('value',quantity);
                        }

                    </script>
                    <div class="container-fluid p-0 ps-md-4  my-3 row">
                        <div class="col-12 p-0">
                            <div class="row my-1">
                                <div class="col-12 col-md-6 text-black fw-bold">
                                    <h6 class="text-black fw-bold ">LOCATION</h6>
                                </div>
                                <div class="col-12 col-md-6 text-black">
                                    <p>Highlands, Scotland</p>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-12 col-md-6 text-black fw-bold">
                                    <h6 class="text-black fw-bold">AGE</h6>
                                </div>
                                <div class="col-12 col-md-6 text-black">
                                    <p>{{product.age}}</p>
                                </div>
                            </div>
                            <div class="row my-1">
                                <div class="col-12 col-md-6 text-black fw-bold">
                                    <h6 class="text-black fw-bold">CASK</h6>
                                </div>
                                <div class="col-12 col-md-6 text-black">
                                    <p>Bourbon & Spanish</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="wiskey-info ps-md-4 m-0 py-2 mx-3 my-3">
                    <h4 class="fw-bold text-black mb-2">WHISKY INFO</h4>
                    <p>
                        {{product.info}}
                    </p>
                </div>
                
            </div>
        </div>
    </div>
</div>


<div class="container  product-review-box mb-2">
    <div class="product-review my-2 py-2">
        <div>
            <h4 class="text-black fw-bold my-2"> 
                Customer Reviews
            </h4>
            <div class="row">
                <div class="col-12 col-md-6">
                    <h4 class="text-black fw-bold">
                        {% comment %} <i class="fas fa-star"></i> {% endcomment %}
                        {% comment %} <i class="fas fa-star-half-alt"></i>   {% endcomment %}
                        <span> Based on {{total_comment}} reviews</span>
                    </h4>
                </div>

                <!--
                
                    <div class="col-12 col-md-6 d-flex justify-content-end">
                        {% if not user.is_authenticated %}
                            <a href="{% url 'login' %}" class="text-black">Write a Review </a>
                        {% endif %}
                    </div>
                
                -->
                
                {% if buy == True %}
                    <div class="col-12 col-md-6 d-flex justify-content-end">
                        <a href="" class="text-black" data-toggle="modal" onclick="displayForm()"> Write a Review </a>
                    </div>
                  
                {% endif %}
            </div>
        </div>
    </div>

    {% if buy == True %}

        <div class="product-review my-2 py-2" style="display:none" id="formDiv">
            <div class="text-black fw-bold text-center">
                <div class="col-lg-12 col-md-6 d-flex justify-content-center">
                    <form action="{% url 'product:add_comment' %}" method="POST" id="CommentSubmit">
                        {% csrf_token %}
                        <div class="rate">
                            <input type="radio" id="star5" name="rate" value="5" />
                            <label for="star5" title="text">5 stars</label>
                            <input type="radio" id="star4" name="rate" value="4" />
                            <label for="star4" title="text">4 stars</label>
                            <input type="radio" id="star3" name="rate" value="3" />
                            <label for="star3" title="text">3 stars</label>
                            <input type="radio" id="star2" name="rate" value="2" />
                            <label for="star2" title="text">2 stars</label>
                            <input type="radio" id="star1" name="rate" value="1" />
                            <label for="star1" title="text">1 star</label>
                        </div>
                        <input type="hidden" name="id" id="p_id" value="{{product.id}}">
                        <div class="col-12 d-flex justify-content-center pb-2">
                            <textarea rows="2" cols="50" name="comment" required></textarea>
                        </div>
                        <div class="col-12">
                            <a href="" class="btn-sm "><button type="submit" onclick="hideForm()" class="btn-login text-center fw-bold " style="width:160px;">Cancel</button></a>
                            <a href="" class="btn-sm "><button type="submit" class="btn-login text-center fw-bold " style="width:160px;">Comment</button></a>
                        </div>
                    </form>
                    
                </div>
                
            </div>
        </div>

    {% endif %}

    {% for comment in comments %}
        <div class="product-review my-2 py-2">
            <div class="text-black fw-bold">
                <div>
                    {% if comment.stars == 5 %}
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    {% endif %}

                    {% if comment.stars == 4 %}
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    {% endif %}

                    {% if comment.stars == 3 %}
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    {% endif %}

                    {% if comment.stars == 2 %}
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    {% endif %}

                    {% if comment.stars == 1 %}
                        <i class="fas fa-star"></i>
                    {% endif %}
                </div>
                <p class="my-1 text-black">
                    The best so far maybe?
                </p>
                <p class="my-1 text-black">
                    <i>{{comment.created_at}}</i>
                </p>
                <p class="text-muted">
                    {{comment.comment}}
                </p>
            </div>
        </div>
    {% endfor %}
    
</div>



<script>

    function displayForm(){
        id = "{{product.id}}"
        $('#p_id').attr('value',id);
        document.getElementById("formDiv").style.display = "block";

        console.log('{{product.id}}')
    }

    function hideForm(){
        document.getElementById("formDiv").style.display = "none";
        console.log('{{product.id}}')
    }

    $("#CommentSubmit").on('submit',function(e) {
        console.log("CommentSubmit");
        e.preventDefault();
        var form = $(this);
        var formData = new FormData(this)
        var url = form.attr('action'); 
        $.ajax({
            type: "POST",
            url: url,
            data: formData, 
            success: function(data){
                window.location.reload();
                console.log(data)
            },
            error:(err)=>{
                console.log(err)
            },
            cache: false,
            contentType: false,
            processData: false
        });
    });

</script>





{% endblock newMain %}